<!DOCTYPE html>
<html>

<head>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.3/TweenMax.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/ScrollMagic.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/plugins/animation.gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/plugins/animation.velocity.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/plugins/debug.addIndicators.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/plugins/jquery.ScrollMagic.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

    <style>
        body {
            background-color: black;
        }

        .container-fluid {
            background-color: black;
            vertical-align: middle;
            padding-left: 0px;
            padding-right: 0px;
            max-height: 100%;
        }

        .model {
            background-color: black;
            align-items: center;
            width: 100%;
        }
    </style>
</head>

<body>
    <div id="scene1" class="container-fluid ">
        <video loop autoplay playsinline muted id="model1" class="model">
            <source src="./assets/utopian01.mp4" type='video/mp4' />
        </video>
    </div>
    <div id="scene2" class="container-fluid ">
        <video loop autoplay playsinline muted id="model2" class="model">
            <source src="./assets/utopian02.mp4" type='video/mp4' />
        </video>
    </div>
    <div id="scene3" class="container-fluid ">
        <video loop autoplay playsinline muted id="model3" class="model">
            <source src="./assets/reflective01.mp4" type='video/mp4' />
        </video>
    </div>
    <div id="scene4" class="container-fluid ">
        <video loop autoplay playsinline muted id="model4" class="model">
            <source src="./assets/reflective02.mp4" type='video/mp4' />
        </video>
    </div>
    <div id="scene5" class="container-fluid ">
        <video loop autoplay playsinline muted id="model5" class="model">
            <source src="./assets/reflective03.mp4" type='video/mp4' />
        </video>
    </div>
</body>
<script>
    $(function () {
        var model_list = [
            'utopian01',
            'utopian02',
            'reflective01',
            'reflective02',
            'reflective03'
        ];

        var control = new ScrollMagic.Controller();
        var scrollPos = 0;
        var lastPos = scrollPos;
        var per_duration = 2500;

        for (var i = 0; i < 1; i++) {
            var vid = document.getElementById(`model${i+1}`);
            var h = document.getElementById(`model${i+1}`);

            var sc1 = new ScrollMagic.Scene({
                triggerElement: `#scene${i+1}`,
                duration: per_duration
            })
            .setPin(`#scene${i+1}`);

            const startAnim = () => {
                sc1.addTo(control)
                    .on("progress", (e) => {
                        scrollPos = e.progress;
                        console.log("TIME : ", scrollPos);
                    });

                setInterval(() => {
                    if (lastPos === scrollPos) return;
                    requestAnimationFrame(() => {
                        vid.currentTime = vid.duration * scrollPos;
                        console.log(scrollPos, vid.duration, vid.currentTime);
                        vid.pause();
                        lastPos = scrollPos;
                    });
                }, 10);
            }

            const preloadVid = (v, callback) => {
                const ready = () => {
                    v.removeEventListener('canplaythrough', ready);
                    let i = setInterval(() => {
                        vid.pause();
                        if (v.readyState > 3) {
                            clearInterval(i);
                            vid.currentTime = 0;
                            callback();
                        }
                    }, 50)
                }

                v.addEventListener('canplaythrough', ready, false);
                v.play();
            }

            preloadVid(vid, startAnim)
        }

    });
</script>

</html>