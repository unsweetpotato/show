<!DOCTYPE html>
<html>

<head>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.3/TweenMax.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/ScrollMagic.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/plugins/animation.gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/plugins/animation.velocity.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/plugins/debug.addIndicators.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/plugins/jquery.ScrollMagic.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

    <style>
        body {
            background-color: black;
            align-items: center;
            height: 100%;
  overflow: hidden;
        }

        .progress {
            position: absolute;
            top: 50%;
            left: 30%;
            transform: translate(0%, -50%);
            width: 40%;
            z-index: 10;
        }


        .model {
            max-width: 100%;
            max-height: 100%;
            align-items: center;
        }

        .container-fluid {
            z-index: 0;
        }

        .align-middle {
            margin-top: auto;
            margin-bottom: auto;
        }
    </style>
</head>

<body>
    <div class="progress align-middle">
        <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0"
            aria-valuemax="1750">
            <span class="sr-only">70% Complete</span>
        </div>
    </div>
</body>
<script>
    $(function () {
        let model_list = [
            'utopian01',
            'utopian02',
            'reflective01',
            'reflective02',
            'reflective03'
        ];
        let progress = 0;
        let images = new Array(model_list.length);
        const img_n = 250,
            per_duration = 2500;

        /*
         * Image Loading
         */
        for (var j = 0; j < model_list.length; j++) {
            images[j] = new Array();
            // Create scene
            document.body.innerHTML +=
                `<div id="scene${j+1}" class="container-fluid" style="visibility:hidden"><img id="model${j+1}" class="model"></div>`;

            for (var i = 0; i < img_n; i++) {
                var img_temp = new Image();
                img_temp.addEventListener('load', () => {
                    progress += 1;
                    // Update progress bar
                    if (progress % img_n == 0) {
                        $('.progress-bar').css('width', progress / (model_list.length * img_n) * 100 + '%').attr("aria-valuenow", progress);
                    }
                    // End of loading
                    if (progress == img_n * model_list.length) {
                        document.body.style.overflow = 'visible';
                        $('.container-fluid').css('visibility', 'visible');
                        $('.progress').css('display', 'none');
                        console.log("gg");
                        
                    }
                });
                img_temp.src = `./assets/${model_list[j]}/${model_list[j]}${i.toString().padStart(3,'0')}.jpg`;
                images[j].push(img_temp);
            }
        }

        /*
         * Scroll Animation
         */

        // init controller
        let controller = new ScrollMagic.Controller({
            globalSceneOptions: {
                triggerHook: 0
            }
        });

        // TweenMax can tween any property of any object. We use this object to cycle through the array
        let currs = new Array(model_list.length);

        for (var i = 0; i < model_list.length; i++) {
            currs[i] = {
                cur_img: 0
            };

            // create tween
            var tween = TweenMax.to(currs[i], 1 / model_list.length, {
                cur_img: img_n - 1,
                roundProps: "cur_img",
                repeat: 0,
                immediateRender: true,
                ease: Linear.easeNone, // show every image the same ammount of time
                onUpdate: function (model_name) {
                    console.log(images[model_name][currs[model_name].cur_img].src);
                    $(`#model${model_name+1}`).attr("src", images[model_name][currs[model_name]
                        .cur_img
                    ].src);
                },
                onUpdateParams: [i]
            });

            // build scene
            var scene = new ScrollMagic.Scene({
                    triggerElement: `#scene${i+1}`,
                    duration: per_duration,
                })
                .setPin(`#scene${i+1}`)
                .setTween(tween)
                .addTo(controller);
        }
    });
</script>

</html>